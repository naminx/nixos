#!/usr/bin/env bash

nullglob=$(shopt -p nullglob); shopt -s nullglob extglob

if [ -z "$1" ]; then
    files=( *.@(jpg|png|webp) )
else
    files=( )
    for arg in "$@"; do
        if [ -f "$arg" ]; then
            files+=( "$arg" )
        elif [ -d "$arg" ]; then
            files+=( "$arg"/*.@(jpg|png|webp) )
        fi
    done
fi

if [ ${#files[@]} -gt 0 ]; then
    dims=( $(magick identify -ping -format %wx%h' ' "${files[@]}") )
    result=( )
    for ((i=0;i<${#files[@]};i++)); do
         dim=${dims[$i]}
         width=${dim%x*}
         height=${dim#*x}
        if [ $width -gt $height ]; then
            result+=("${files[$i]}")
        fi
    done
    if [ ${#result[@]} -gt 0 ]; then
        ls -1 --quoting-style=shell-escape "${result[@]}"
    fi
fi

$nullglob; unset nullglob
